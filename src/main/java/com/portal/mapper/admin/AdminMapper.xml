<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.portal.mapper.admin.AdminMapper">
	
	<!-- adminMember -->
	<delete id="deleteAdminMemberById">
		DELETE FROM AdminMember 
		WHERE id = #{id};
	</delete>

	<delete id="deleteAdminAuthorityByAdminId">
		DELETE FROM AdminAuthority 
		WHERE adminId = #{id};
	</delete>

	<update id="updateAdminMember">
		UPDATE AdminMember
		SET
			name = #{name},
			adminMemberId = #{adminMemberId},
			password = #{password}
		WHERE
			id = #{id}
	</update>

	<select id="selectAdminMemberByUserName" resultMap="adminMemberByUserName">
		SELECT m.id, m.name, adminMemberId, password, authority 
		FROM AdminMember m 
		JOIN AdminAuthority a ON m.id = a.adminId
		WHERE adminMemberId = #{username}
	</select>
	
 	<resultMap type="com.portal.domain.admin.AdminMemberDto" id="adminMemberByUserName">
	<id column="id" property="id"/>
	<result column="name" property="name"/>
	<result column="adminMemberId" property="adminMemberId"/>
	<result column="password" property="password"/>
	<collection property="authorityList" ofType="string">
		<result column="authority" property="authority"/>
	</collection>
	</resultMap>

	
	
	<select id="selectAdminMemberAll" resultMap="adminMemberAll">
		SELECT m.id, m.name, adminMemberId, password, authority 
		FROM AdminMember m 
		JOIN AdminAuthority a ON m.id = a.adminId
	</select>
	
 	<resultMap type="com.portal.domain.admin.AdminMemberDto" id="adminMemberAll">
	<id column="id" property="id"/>
	<result column="name" property="name"/>
	<result column="adminMemberId" property="adminMemberId"/>
	<result column="password" property="password"/>
	<collection property="authorityList" ofType="string">
		<result column="authority" property="authority"/>
	</collection>
	</resultMap> 


	<select id="selectLastAdminMemberById" resultType="int">
		SELECT MAX(id) FROM AdminMember
	</select>

	<insert id="insertAdminAuthority">
		INSERT INTO AdminAuthority (adminId, authority)
		VALUES (#{adminId},#{authority})	
	</insert>

	<insert id="insertAdminMember">
		INSERT INTO AdminMember (id, name, adminMemberId, password)
		VALUES (#{id}, #{name}, #{adminMemberId}, #{password})
	</insert>


</mapper>